{"version":3,"sources":["idb.js"],"names":["idb_name","objectStoreName","version","allRestKey","resturantReviewsPrefix","restaurantSingReviewPrefix","syncObjectStoreName","syncCreateNewRestaurantReviewCount","syncFavoriteRestaurantCount","syncUnfavoriteRestaurantCount","syncUpdateRestaurantReviewCount","syncDeleteRestaurantReviewCount","syncOperationIndex","getIDBObject","indexedDB","window","mozIndexedDB","webkitIndexedDB","msIndexedDB","shimIndexedDB","open","onupgradeneeded","db","result","store","createObjectStore","allResturnats","callback","onsuccess","tx","transaction","objectStore","data","get","event","target","onerror","error","undefined","oncomplete","close","resturantByID","id","resturantReviews","k","addAllResturants","restJson","put","addResturant","addResturantReviews","restReviewsJson","count","key","addToSyncListReviews","category","objKey","Date","now","syncData","tmp","JSON","parse","stringify","updateExistingSyncObject","newValue","getAllPendingReviews","resturantID","openCursor","cursor","value","rev","restaurant_id","continue","iterateSyncIDB","info","cursKey","removeFromSyncIDB","delete","removeResturantReviews","resId","req","console","log","evt","errorCode"],"mappings":"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","file":"idb.js","sourcesContent":["const idb_name = 'mws-restaurant-stage-1';\r\nconst objectStoreName =  'Restaurants';\r\nconst version = 1;\r\n\r\nconst allRestKey = 'allResturnats';\r\nconst resturantReviewsPrefix = 'ReviewsRestuarant_';\r\nconst restaurantSingReviewPrefix = 'Review_';\r\n\r\nconst syncObjectStoreName = 'syncRequests';\r\nvar syncCreateNewRestaurantReviewCount = 0;\r\nvar syncFavoriteRestaurantCount = 10000;\r\nvar syncUnfavoriteRestaurantCount = 20000;\r\nvar syncUpdateRestaurantReviewCount = 30000;\r\nvar syncDeleteRestaurantReviewCount = 40000;\r\nvar syncOperationIndex = 0;\r\n\r\n\r\nvar getIDBObject =() => {\r\n\tvar indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB || window.shimIndexedDB;\r\n\tvar open = indexedDB.open(idb_name, version);\r\n\topen.onupgradeneeded = function() {\r\n\t\tvar db = open.result;\r\n\t\tvar store = db.createObjectStore(objectStoreName);\r\n\t\tvar store = db.createObjectStore(syncObjectStoreName);\r\n\t};\r\n\treturn open;\r\n}\r\n\r\nvar allResturnats = (callback) => {\r\n\t\r\n\tlet open = getIDBObject();\r\n\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n    \tvar tx = db.transaction(objectStoreName);\r\n    \tvar store = tx.objectStore(objectStoreName);\r\n    \tvar data = store.get(allRestKey);\r\n    \t\r\n\t    data.onsuccess =(event)=>{\r\n    \t\tcallback(null ,event.target.result);\r\n    \t}\r\n\t    data.onerror = (error)=>{\r\n\t    \tcallback(error, undefined);\r\n\t    }\r\n\t    tx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t};\r\n\r\n}\r\n\r\n\r\nfunction resturantByID(id, callback){\r\n\tlet open = getIDBObject();\r\n\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n    \tvar tx = db.transaction(objectStoreName);\r\n    \tvar store = tx.objectStore(objectStoreName);\r\n    \tvar data = store.get(id);\r\n    \t\r\n    \tdata.onsuccess =(event)=>{\r\n    \t\tcallback(null ,event.target.result);\r\n    \t}\r\n    \tdata.onerror = (error)=>{\r\n\t    \tcallback(error, undefined);\r\n\t    }\r\n    \ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t};\r\n}\r\n\r\nfunction resturantReviews(id, callback){\r\n\tlet open = getIDBObject();\r\n\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n    \tvar tx = db.transaction(objectStoreName);\r\n    \tvar store = tx.objectStore(objectStoreName);\r\n    \tlet k = resturantReviewsPrefix + id;\r\n    \tif(k === 1){\r\n    \t\tk = restaurantSingReviewPrefix + id;\r\n    \t}\r\n    \tvar data = store.get(k);\r\n    \tdata.onsuccess =(event)=>{\r\n    \t\tcallback(null ,event.target.result);\r\n    \t}\r\n\r\n    \tdata.onerror = (error)=>{\r\n    \t\tcallback(error, undefined);\r\n    \t}\r\n    \ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t};\r\n}\r\n\r\nvar addAllResturants = (restJson) => {\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(objectStoreName);\r\n\t\tstore.put(restJson, allRestKey);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t    return;\r\n\t}\r\n}\r\n\r\n\r\nvar addResturant = (id, restJson) =>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(objectStoreName);\r\n\t\tstore.put(restJson, id);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n}\r\n\r\nvar addResturantReviews = (id, restReviewsJson, count=-1) =>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(objectStoreName);\r\n\t\tlet key = resturantReviewsPrefix+id;\r\n\t\tif(count === 1){\r\n\t\t\tkey = restaurantSingReviewPrefix + id;\r\n\t\t}\r\n\t\tstore.put(restReviewsJson, key);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n}\r\n\r\n\r\nvar addToSyncListReviews = (data, category)=>{\r\n\tlet open = getIDBObject();\r\n\r\n\t// const objKey = `Sync_action_no_${syncOperationIndex}`;\r\n\t// syncOperationIndex++;\r\n\t\r\n\tconst objKey = `Sync_action_no_${Date.now()}`;\r\n\r\n\tlet syncData = {'data': data, 'category': -1};\r\n\tif(category === 'NewReview'){\r\n\t\tlet tmp = JSON.parse(data);\r\n\t\ttmp.id = objKey;\r\n\t\tsyncData.data = JSON.stringify(tmp);\r\n\t\tsyncData.category = syncCreateNewRestaurantReviewCount;\r\n\t\t// store.put(data, syncCreateNewRestaurantReviewCount);\r\n\t\t// syncCreateNewRestaurantReviewCount++;\r\n\t}else if(category === 'DeleteReview'){\r\n\t\tsyncData.category = syncDeleteRestaurantReviewCount;\r\n\r\n\t\t// store.put(data, syncDeleteRestaurantReviewCount);\r\n\t\t// syncDeleteRestaurantReviewCount++;\r\n\t}else if(category === 'UpdateReview'){\r\n\t\tsyncData.category = syncUpdateRestaurantReviewCount;\r\n\t\t// store.put(data, syncUpdateRestaurantReviewCount);\r\n\t\t// syncUpdateRestaurantReviewCount++;\r\n\t}else if(category === 'Favorite'){\r\n\t\tsyncData.category = syncFavoriteRestaurantCount;\r\n\t\t// store.put(data, syncFavoriteRestaurantCount);\r\n\t\t// syncFavoriteRestaurantCount++;\r\n\t}else if(category === 'unFavorite'){\r\n\t\tsyncData.category = syncUnfavoriteRestaurantCount;\r\n\t\t// store.put(data, syncUnfavoriteRestaurantCount);\r\n\t\t// syncUnfavoriteRestaurantCount++;\r\n\t}\r\n\r\n\t\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(syncObjectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(syncObjectStoreName);\r\n\t\t\r\n\t\tstore.put(syncData, objKey);\r\n\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n\treturn {'key': objKey , 'value': syncData};\r\n}\r\n\r\nvar updateExistingSyncObject=(objKey, newValue)=>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(syncObjectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(syncObjectStoreName);\r\n\t\tstore.put(newValue, objKey);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n}\r\n\r\n\r\nvar getAllPendingReviews = (resturantID, callback)=>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(syncObjectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(syncObjectStoreName);\r\n\t\tstore.openCursor().onsuccess = function(event) {\r\n  \t\t\tvar cursor = event.target.result;\r\n  \t\t\tif (cursor) {\r\n  \t\t\t\tif(cursor.value.category < syncFavoriteRestaurantCount){\r\n  \t\t\t\t\tlet rev = cursor.value;\r\n\t\t\t\t    if(JSON.parse(cursor.value.data).restaurant_id === resturantID ){\r\n\t\t\t\t    \tcallback( rev, cursor.key, false);\r\n\t\t\t\t    }\r\n\t\t\t\t    cursor.continue();\r\n  \t\t\t\t}\r\n\t\t\t  }\r\n  \t\t}\r\n\t}\r\n}\r\n\r\nvar iterateSyncIDB = (callback)=>{\r\n\tvar open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(syncObjectStoreName);\r\n\t\tvar store = tx.objectStore(syncObjectStoreName);\r\n\r\n\t\tstore.openCursor().onsuccess = function(event) {\r\n\t\t\tvar cursor = event.target.result;\r\n\t\t\tif (cursor) {\r\n\t\t\t  \tconst info = cursor.value.data;\r\n\t\t\t  \tconst category = cursor.value.category;\r\n\t\t\t  \tconst cursKey = cursor.key;\r\n\r\n\t\t\t  \tcallback(cursKey, info, category);\r\n\r\n\t\t\t  \tcursor.continue();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar removeFromSyncIDB = (id)=>{\r\n\tvar open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(syncObjectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(syncObjectStoreName);\r\n\t\tstore.delete(id);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n}\r\n\r\nvar removeResturantReviews = (resId)=>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(objectStoreName);\r\n\t\tlet req = store.delete(resturantReviewsPrefix + resId);\r\n\r\n\t\treq.onsuccess = (event)=>{\r\n\t\t\tconsole.log('resturant ' + resId + ' reviews removed successfully from IDB..');\r\n\t\t}\r\n\r\n\t\treq.onerror = (event)=>{\r\n\t\t\tconsole.error( 'ERROR during removeResturantReviews: ' , evt.target.errorCode);\r\n\t\t}\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t\treturn;\r\n\t}\r\n}"]}