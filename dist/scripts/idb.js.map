{"version":3,"sources":["idb.js"],"names":["idb_name","objectStoreName","version","allRestKey","resturantReviewsPrefix","syncObjectStoreName","syncReviewsCount","getIDBObject","indexedDB","window","mozIndexedDB","webkitIndexedDB","msIndexedDB","shimIndexedDB","open","onupgradeneeded","db","result","store","createObjectStore","allResturnats","callback","onsuccess","tx","transaction","objectStore","data","get","oncomplete","close","event","target","resturantByID","id","resturantReviews","k","addAllResturants","restJson","put","addResturant","addResturantReviews","restReviewsJson","addToSyncListReviews","getAllPendingReviews","resturantID","openCursor","cursor","rev","value","restaurant_id","continue"],"mappings":"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","file":"idb.js","sourcesContent":["const idb_name = 'mws-restaurant-stage-1';\r\nconst objectStoreName =  'Restaurants';\r\nconst version = 1;\r\n\r\nconst allRestKey = 'allResturnats';\r\nconst resturantReviewsPrefix = 'ReviewsRestuarant_';\r\n\r\nconst syncObjectStoreName = 'syncRequests';\r\nvar syncReviewsCount = 0;\r\n\r\nvar getIDBObject =() => {\r\n\tvar indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB || window.shimIndexedDB;\r\n\tvar open = indexedDB.open(idb_name, version);\r\n\topen.onupgradeneeded = function() {\r\n\t\tvar db = open.result;\r\n\t\tvar store = db.createObjectStore(objectStoreName);\r\n\t\tvar store = db.createObjectStore(syncObjectStoreName);\r\n\t};\r\n\treturn open;\r\n}\r\n\r\nvar allResturnats = (callback) => {\r\n\t\r\n\tlet open = getIDBObject();\r\n\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n    \tvar tx = db.transaction(objectStoreName);\r\n    \tvar store = tx.objectStore(objectStoreName);\r\n    \tvar data = store.get(allRestKey);\r\n    \ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t    data.onsuccess =(event)=>{\r\n    \t\tcallback(null ,event.target.result);\r\n    \t}\r\n\t    // callback(null, data);\r\n    \t// return data;\r\n\t};\r\n\r\n}\r\n\r\n\r\nfunction resturantByID(id, callback){\r\n\tlet open = getIDBObject();\r\n\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n    \tvar tx = db.transaction(objectStoreName);\r\n    \tvar store = tx.objectStore(objectStoreName);\r\n    \tvar data = store.get(id);\r\n    \t// callback(null, data);\r\n    \tdata.onsuccess =(event)=>{\r\n    \t\tcallback(null ,event.target.result);\r\n    \t}\r\n    \ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t};\r\n}\r\n\r\nfunction resturantReviews(id, callback){\r\n\tlet open = getIDBObject();\r\n\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n    \tvar tx = db.transaction(objectStoreName);\r\n    \tvar store = tx.objectStore(objectStoreName);\r\n    \tlet k = resturantReviewsPrefix + id;\r\n    \tvar data = store.get(k);\r\n    \tdata.onsuccess =(event)=>{\r\n    \t\tcallback(null ,event.target.result);\r\n    \t}\r\n    \ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t};\r\n}\r\n\r\nvar addAllResturants = (restJson) => {\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(objectStoreName);\r\n\t\tstore.put(restJson, allRestKey);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t    return;\r\n\t}\r\n}\r\n\r\n\r\nvar addResturant = (id, restJson) =>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(objectStoreName);\r\n\t\tstore.put(restJson, id);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n}\r\n\r\nvar addResturantReviews = (id, restReviewsJson) =>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(objectStoreName);\r\n\t\tstore.put(restReviewsJson, resturantReviewsPrefix+id);\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n}\r\n\r\nvar addToSyncListReviews = (data)=>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(syncObjectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(syncObjectStoreName);\r\n\t\tstore.put(data, syncReviewsCount);\r\n\t\tsyncReviewsCount++;\r\n\t\ttx.oncomplete = function() {\r\n\t        db.close();\r\n\t    };\r\n\t}\r\n}\r\n\r\n\r\nvar getAllPendingReviews = (resturantID, callback)=>{\r\n\tlet open = getIDBObject();\r\n\topen.onsuccess = ()=>{\r\n\t\tvar db = open.result;\r\n\t\tvar tx = db.transaction(syncObjectStoreName, 'readwrite');\r\n\t\tvar store = tx.objectStore(syncObjectStoreName);\r\n\t\tstore.openCursor().onsuccess = function(event) {\r\n  \t\t\tvar cursor = event.target.result;\r\n  \t\t\tif (cursor) {\r\n\t\t\t    let rev = cursor.value;\r\n\t\t\t    if(rev.restaurant_id === resturantID){\r\n\t\t\t    \tcallback(rev);\r\n\t\t\t    }\r\n\t\t\t    cursor.continue();\r\n\t\t\t  }\r\n  \t\t}\r\n\t}\r\n}\r\n\r\n// var removeResturantReviews = (resId)=>{\r\n// \tlet open = getIDBObject();\r\n// \topen.onsuccess = ()=>{\r\n// \t\tvar db = open.result;\r\n// \t\tvar tx = db.transaction(objectStoreName, 'readwrite');\r\n// \t\tvar store = tx.objectStore(objectStoreName);\r\n// \t\tlet req = store.delete(resturantReviewsPrefix + resId);\r\n\r\n// \t\treq.onsuccess = (event)=>{\r\n// \t\t\tconsole.log('resturant ' + resId + ' reviews removed successfully from IDB..');\r\n// \t\t}\r\n\r\n// \t\treq.onerror = (event)=>{\r\n// \t\t\tconsole.error( 'ERROR during removeResturantReviews: ' , evt.target.errorCode);\r\n// \t\t}\r\n// \t\ttx.oncomplete = function() {\r\n// \t        db.close();\r\n// \t    };\r\n// \t\treturn;\r\n// \t}\r\n// }"]}