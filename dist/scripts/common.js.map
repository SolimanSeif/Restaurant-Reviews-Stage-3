{"version":3,"sources":["common.js"],"names":["CONST_FAVORITIFY_ACTION_SPAN_ID_PREFIX","CATEGORY_MARK_AS_FAVORIT","CATEGORY_MARK_AS_UN_FAVORIT","syncInfo","iterateSyncIDB","cursKey","info","category","syncWorker","Worker","postMessage","onmessage","message","data","isCompleted","removeFromSyncIDB","postSyncAction","postSyncActionComplete","actionName","jsonInfo","JSON","parse","DBHelper","fetchRestaurantReviews","restaurant_id","undefined","window","navigator","onLine","addEventListener","customNotification","alert","Notification","permission","notification","requestPermission","markRestaurantAsFavorit","restaurantID","is_favorite","index","console","log","switchSpanIcon","span","document","getElementById","className","setAttribute","successCallback","response","fetchRestaurants","fetchRestaurantById","failCallback","addToSyncListReviews","favoriteRestaurant"],"mappings":"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","file":"common.js","sourcesContent":["\r\nconst CONST_FAVORITIFY_ACTION_SPAN_ID_PREFIX = 'FavoritMark_';\r\nconst CATEGORY_MARK_AS_FAVORIT = 'Favorite';\r\nconst CATEGORY_MARK_AS_UN_FAVORIT = 'unFavorite';\r\n\r\nvar syncInfo = ()=>{\r\n\r\n\titerateSyncIDB((cursKey, info, category)=>{\r\n\t\tlet syncWorker = new Worker('scripts/workers/syncWorker.js');\r\n\t\tsyncWorker.postMessage({'cursKey': cursKey, 'info': info, 'category': category});\r\n\t\t\r\n\t\tsyncWorker.onmessage =(message)=>{\r\n\t\t\tlet data = message.data;\r\n\t\t\tif(data.isCompleted){\r\n\t\t\t\tremoveFromSyncIDB(data.cursKey);\r\n\t\t\t\tif(data.postSyncAction){\r\n\t\t\t\t\tpostSyncActionComplete(data.postSyncAction, info);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nvar postSyncActionComplete = (actionName, info)=>{\r\n\tif(actionName === 'recachingRestaurantReviews'){\r\n\t\tlet jsonInfo = JSON.parse(info);\r\n\t\t//restaurant_id\r\n\t\tDBHelper.fetchRestaurantReviews(jsonInfo.restaurant_id, undefined, undefined);\r\n\t}\r\n}\r\n\r\n\r\nif(window.navigator.onLine){\r\n\t// customNotification('I will start synchronization');\r\n\tsyncInfo();\r\n}\r\n\r\nwindow.addEventListener('online', ()=>{\r\n  customNotification('You back to Online mode');\r\n  syncInfo();\r\n});\r\n\r\nwindow.addEventListener('offline', ()=>{\r\n  customNotification('You are running in offline mode');\r\n});\r\n\r\n\r\nfunction customNotification(message) {\r\n  // Let's check if the browser supports notifications\r\n  if (!('Notification' in window)) {\r\n    alert(message);\r\n  }\r\n  // Let's check whether notification permissions have already been granted\r\n  else if (Notification.permission === 'granted') {\r\n    // If it's okay let's create a notification\r\n    var notification = new Notification(message);\r\n  }else if (Notification.permission !== 'denied') {\r\n    Notification.requestPermission(function (permission) {\r\n      // If the user accepts, let's create a notification\r\n      if (permission === 'granted') {\r\n        var notification = new Notification(message);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n\r\nvar markRestaurantAsFavorit = (restaurantID, is_favorite, index)=>{\r\n  console.log(`restaurant id: ${restaurantID} , is_favorite : ${is_favorite} , index: ${index}` );\r\n\r\n  let switchSpanIcon=()=>{\r\n  \tlet span = document.getElementById(`${CONST_FAVORITIFY_ACTION_SPAN_ID_PREFIX}${restaurantID}`);\r\n  \tif(span.className === 'fontawesome-heart-empty'){\r\n  \t\tspan.className = 'fontawesome-heart';\r\n  \t}else{\r\n  \t\tspan.className = 'fontawesome-heart-empty';\r\n  \t}\r\n  \tspan.setAttribute('onclick',`markRestaurantAsFavorit(${restaurantID}, ${!is_favorite}, ${index})`);\r\n  }\r\n\r\n  let successCallback = (response)=>{\r\n  \tswitchSpanIcon();\r\n\r\n  \tif(index >= 0){ // working from home page\r\n  \t\tDBHelper.fetchRestaurants(undefined);\r\n  \t}else{\r\n  \t\tDBHelper.fetchRestaurantById(restaurantID, undefined);\r\n  \t}\r\n  };\r\n  \r\n  let failCallback= ()=>{\r\n  \tswitchSpanIcon();\r\n  \tif(is_favorite === true || is_favorite === 'true'){\r\n  \t\taddToSyncListReviews(restaurantID, CATEGORY_MARK_AS_UN_FAVORIT);\r\n  \t}else{\r\n  \t\taddToSyncListReviews(restaurantID, CATEGORY_MARK_AS_FAVORIT);\r\n  \t}\r\n  };\r\n\r\n  favoriteRestaurant(restaurantID, !is_favorite, successCallback, failCallback);\r\n}"]}