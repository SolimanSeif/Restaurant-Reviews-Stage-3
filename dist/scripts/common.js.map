{"version":3,"sources":["common.js"],"names":["CONST_FAVORITIFY_ACTION_SPAN_ID_PREFIX","CATEGORY_MARK_AS_FAVORIT","CATEGORY_MARK_AS_UN_FAVORIT","MARK_LOCATIONS_ON_MAP","syncInfo","iterateSyncIDB","cursKey","info","category","syncWorker","Worker","postMessage","onmessage","message","data","isCompleted","removeFromSyncIDB","postSyncAction","postSyncActionComplete","actionName","jsonInfo","JSON","parse","DBHelper","fetchRestaurantReviews","restaurant_id","undefined","window","navigator","onLine","addEventListener","customNotification","alert","Notification","permission","notification","requestPermission","markRestaurantAsFavorit","restaurantID","is_favorite","index","console","log","switchSpanIcon","span","document","getElementById","innerHTML","style","color","setAttribute","successCallback","response","fetchRestaurants","fetchRestaurantById","failCallback","addToSyncListReviews","allResturnats","error","restList","i","length","id","addAllResturants","resturantByID","restaurant","addResturant","favoriteRestaurant","loadMapComponent","scr","createElement","src","getElementsByTagName","appendChild"],"mappings":"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","file":"common.js","sourcesContent":["\r\nconst CONST_FAVORITIFY_ACTION_SPAN_ID_PREFIX = 'FavoritMark_';\r\nconst CATEGORY_MARK_AS_FAVORIT = 'Favorite';\r\nconst CATEGORY_MARK_AS_UN_FAVORIT = 'unFavorite';\r\nvar MARK_LOCATIONS_ON_MAP = false;\r\n\r\nvar syncInfo = ()=>{\r\n\r\n\titerateSyncIDB((cursKey, info, category)=>{\r\n\t\tlet syncWorker = new Worker('scripts/workers/syncWorker.js');\r\n\t\tsyncWorker.postMessage({'cursKey': cursKey, 'info': info, 'category': category});\r\n\t\t\r\n\t\tsyncWorker.onmessage =(message)=>{\r\n\t\t\tlet data = message.data;\r\n\t\t\tif(data.isCompleted){\r\n\t\t\t\tremoveFromSyncIDB(data.cursKey);\r\n\t\t\t\tif(data.postSyncAction){\r\n\t\t\t\t\tpostSyncActionComplete(data.postSyncAction, info);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nvar postSyncActionComplete = (actionName, info)=>{\r\n\tif(actionName === 'recachingRestaurantReviews'){\r\n\t\tlet jsonInfo = JSON.parse(info);\r\n\t\t//restaurant_id\r\n\t\tDBHelper.fetchRestaurantReviews(jsonInfo.restaurant_id, undefined, undefined);\r\n\t}\r\n}\r\n\r\n\r\nif(window.navigator.onLine){\r\n\t// customNotification('I will start synchronization');\r\n\tsyncInfo();\r\n}\r\n\r\nwindow.addEventListener('online', ()=>{\r\n  customNotification('You back to Online mode');\r\n  syncInfo();\r\n});\r\n\r\nwindow.addEventListener('offline', ()=>{\r\n  customNotification('You are running in offline mode');\r\n});\r\n\r\n\r\nfunction customNotification(message) {\r\n  // Let's check if the browser supports notifications\r\n  if (!('Notification' in window)) {\r\n    alert(message);\r\n  }\r\n  // Let's check whether notification permissions have already been granted\r\n  else if (Notification.permission === 'granted') {\r\n    // If it's okay let's create a notification\r\n    var notification = new Notification(message);\r\n  }else if (Notification.permission !== 'denied') {\r\n    Notification.requestPermission(function (permission) {\r\n      // If the user accepts, let's create a notification\r\n      if (permission === 'granted') {\r\n        var notification = new Notification(message);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n\r\nvar markRestaurantAsFavorit = (restaurantID, is_favorite, index)=>{\r\n  console.log(`restaurant id: ${restaurantID} , is_favorite : ${is_favorite} , index: ${index}` );\r\n\r\n  let switchSpanIcon=()=>{\r\n  \tlet span = document.getElementById(`${CONST_FAVORITIFY_ACTION_SPAN_ID_PREFIX}${restaurantID}`);\r\n  \tif(is_favorite === true){\r\n      span.innerHTML = '&#xf08a;';\r\n  \t}else{\r\n  \t\tspan.innerHTML = '&#xf004;';\r\n  \t}\r\n    span.style.color = '#8a4500';\r\n  \tspan.setAttribute('onclick',`markRestaurantAsFavorit(${restaurantID}, ${!is_favorite}, ${index})`);\r\n  }\r\n\r\n  let successCallback = (response)=>{\r\n  \tswitchSpanIcon();\r\n\r\n  \t\r\n\t\tDBHelper.fetchRestaurants(undefined);\r\n\t\tDBHelper.fetchRestaurantById(''+restaurantID, undefined);\r\n  \t\r\n  };\r\n  \r\n  let failCallback= ()=>{\r\n  \tswitchSpanIcon();\r\n  \tif(is_favorite === true || is_favorite === 'true'){\r\n  \t\taddToSyncListReviews(restaurantID, CATEGORY_MARK_AS_UN_FAVORIT);\r\n  \t}else{\r\n  \t\taddToSyncListReviews(restaurantID, CATEGORY_MARK_AS_FAVORIT);\r\n  \t}\r\n    //TODO update the index DB\r\n    allResturnats((error, restList)=>{\r\n      if(restList){\r\n        for(let i = 0 ; i < restList.length ; i++){\r\n          if(restList[i].id === restaurantID){\r\n            restList[i].is_favorite = !is_favorite;\r\n            addAllResturants(restList);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    });\r\n    resturantByID(''+restaurantID, (error, restaurant)=>{\r\n      if(restaurant){\r\n        restaurant.is_favorite = !is_favorite;\r\n        addResturant(''+restaurantID, restaurant);\r\n      }\r\n    });\r\n  };\r\n\r\n  favoriteRestaurant(restaurantID, !is_favorite, successCallback, failCallback);\r\n}\r\n\r\nvar loadMapComponent=()=>{\r\n  MARK_LOCATIONS_ON_MAP = true;\r\n  document.getElementById('map').innerHTML = '';\r\n  let scr = document.createElement('script');\r\n  scr.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyDwMy2iEU4nOLJA70oAdpF2uG9ey8jBBlU&libraries=places&callback=initMap';\r\n  document.getElementsByTagName('head')[0].appendChild(scr);\r\n}"]}